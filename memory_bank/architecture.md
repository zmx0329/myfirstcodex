# 用于记录每个文件的作用

- `memory_bank/design_document.md`：产品需求与交互细节。
- `memory_bank/tech_stack.md`：技术栈和外部服务选型（Nano Banana 生图、Azure Vision 检测、Supabase 存储等）。
- `memory_bank/implementation_plan.md`：分步实施与验证计划。
- `memory_bank/progress.md`：已完成步骤记录。
- `memory_bank/architecture.md`：本文件，概述文件/目录作用（memory_bank 目录仅存放说明文档与设计资产）。
- `frontend/`：前端工程（Vite + React + TS + React Router，持续迭代星露谷风界面）。
- `frontend/package.json` / `frontend/package-lock.json`：前端依赖清单，包含 `react-router-dom` 路由与 `zustand` 状态管理；锁文件已生成。
- `frontend/src/App.tsx`：应用入口与路由配置，提供主页（Home）、捕物页（Capture）、珍藏页（Collection），并将未知路径重定向到主页。
- `frontend/src/pages/Home.tsx`：主页，背景使用 `public/home-bg.png`，捕物/珍藏按钮热点位于原图按钮位置。
- `frontend/src/pages/Capture.tsx`：捕物页，2D 像素 RPG 木质室内风；上传后等比压缩到 720–1600px 并调用 Nano Banana mock 生成像素预览（失败回退本地像素滤镜），自动生成 3–5 个 mock 检测框；物品栏/画布框/表单实时三联动，标签样式复刻 Stardew 橙色卡片（名称/类别/描述/能量/生命填入，含图标和分隔线），支持拖拽与角落把手缩放不越界；时间支持月/日/时/分编辑与同步，驱动表盘指针，保存按钮随可保存状态启用。
- `frontend/src/pages/Collection.tsx`：珍藏页，木墙背景 + 木牌标题，卡片为木质相框 + 羊皮纸内容，含编号角标、缩略图占位、标题与时间信息，网格整齐排列，hover/按下有像素硬阴影反馈。
- `frontend/src/state/capture-store.ts`：Zustand 全局状态模型（上传文件/预览、检测框列表、当前选中框、标签草稿、保存状态），标签草稿按检测框 ID 存储，字段涵盖名称/类别/描述/能量/生命/时间/标签位置比例与缩放；设置检测框时自动计算面积并默认选中最大框。
- `frontend/src/state/capture-store.test.ts`：Vitest 验证默认选中最大框与切换选中 ID 的逻辑。
- `frontend/vite.config.ts`：Vite 配置，启用 React 插件并指定 Vitest 运行环境为 jsdom。
- `frontend/src/App.css`：全局样式与布局，捕物页采用约 1.6/1.2 栅格，包含像素预览舞台、可点击识别框、可拖拽缩放的橙色 Stardew 标签卡、表盘式时间组件（日期/时间分行）、上传/错误/加载提示、木质表单与数值步进器，以及物品栏缩略图/底部按钮的像素风交互视觉。
- `frontend/src/index.css`：基础排版与 reset，统一字体和盒模型。
- `backend/`：后端工程（FastAPI），负责检测、文案生成兜底、像素合成与存储；默认使用本地存储，提供 `/detect`、`/generate-text`、`/generate-image`、`/save-artwork`、`/artworks`、`/health`、`/config/storage`。
- `backend/requirements.txt` / `backend/.env.example`：后端依赖与环境变量示例（阿里云 ObjectDet、文案/生图服务、Supabase、本地存储目录）。
- `backend/app/main.py`：FastAPI 应用工厂，挂载健康检查、检测/文案/保存/列表路由与存储模式查询。
- `backend/app/config.py`：环境变量配置加载，判定是否走本地存储。
- `backend/app/dependencies.py`：注入 Settings、Detection/Text/ImageGen/Artwork 服务的单例。
- `backend/app/routers/health.py` / `detect.py` / `text_gen.py` / `image_gen.py` / `artworks.py`：路由定义，负责请求/错误映射。
- `backend/app/services/detection_service.py` / `text_service.py` / `image_gen_service.py` / `image_service.py` / `artwork_service.py`：检测（阿里云 ObjectDet 优先，其次 Azure，缺省稳定兜底）、文案生成（LLM 失败用模板）、生图（远程模型失败时本地像素化）、Pillow 标签+时间+金币合成、作品保存/列表。
- `backend/app/clients/detection_client.py` / `text_client.py` / `storage_client.py`：对阿里云/ Azure CV、文案 API、Supabase/本地文件存储的调用封装。
- `backend/app/models/*.py`：Pydantic 契约（检测、文案、生图、作品保存/列表、公用数据结构）。
- `backend/app/tests/test_api.py`：Pytest 契约测试，覆盖健康检查、检测错误映射、文案兜底、生图兜底、合成哈希一致性与列表返回。
