# 设计计划（基础优先，含可操作的验证方法）

1. **初始化前端工程**：用 Vite+React+TS 创建项目，添加 Zustand、Canvas/SVG 依赖，保留 npm scripts（dev/build/lint）。  
   - 验证：本地运行开发服务器能打开空白页，执行构建和 lint 均无错误。
2. **路由与骨架占位**：主界面只保留两个可点按钮（捕物、珍藏），捕物页划分左预览/右编辑/下物品栏，珍藏页网格占位。  
   - 验证：手动点击确认只有这两个按钮可导航，三页布局区域与比例符合 PRD（左约 60%，右约 40%）。
3. **全局状态模型**：定义上传文件、预览 URL、检测框列表、当前选中框 ID、标签数据（名称/类别/描述/能量/生命/时间/标签位置与缩放）、保存状态。  
   - 验证：用固定 2–3 个框的 mock（含面积），断言默认选中 ID = 面积最大；切换选中 ID 状态正确更新。
4. **捕物页静态 UI**：左侧画布含识别框层和标签层容器，右侧编辑面板区块，右下物品栏格子，底部更换/保存按钮，右上返回。  
   - 验证：视觉对照 PRD 草图或 Figma，占位与比例一致；无上传时显示空态区域。
5. **上传入口与空态**：未上传时显示木框占位和上传按钮，支持点击/拖拽接收图片并生成本地预览。  
   - 验证：拖拽与文件选择各操作一次，状态内有文件信息，预览切换为新图，空态消失。

6. **前端像素预览与交互基础**：上传后调用 Nano Banana 模型生成像素预览（提示词同原 17），加载态 + 失败兜底滤镜；生成 3–5 个 mock 框默认选最大；物品栏/画布框/表单三联动；标签实时联动（名称/类别/描述/能量/生命/时间）、拖拽缩放不越界；时间组件可同步当前时间；更换/保存按钮状态随检测结果；上传尺寸压到 720–1600px（目标 1280px）等比。  
   - 验证：上传成功/超时切换预览与提示；默认高亮最大框并记录 ID；点击框/格子/表单同步；数值边界 0–200 连点不越界，时间同步读系统时间；无框时保存置灰；超大/超小图预览落在区间。
7. **后端基础与生成管线**：FastAPI 初始化 + 健康检查；封装检测客户端（Azure CV，重试/限速/兜底）；文案生成服务（失败用星露谷模板）；像素风生成 + Pillow 叠加标签/时间/金币 88888888，保证与前端预览一致；Supabase 存储/数据库记录作品 ID、用户 ID、URL、创建时间；定义 `/detect` `/generate-text` `/save-artwork` `/artworks` 契约。  
   - 验证：健康检查 200；模拟 401/429/超时返回友好错误；文案限流时返回模板，正常 1–2 句；同输入两次生成图尺寸/哈希一致且位置匹配前端；存储后能取回 URL，DB 字段类型正确；契约测试覆盖成功/错误结构与前端字段一致。
8. **联调与保存/列表流程**：前端接入检测/文案/保存/列表接口；0 框空态、>20 框分页；描述生成可重生覆盖并有超时兜底；保存按钮防连点，成功弹“去珍藏/继续捕物”，失败可重试；珍藏列表倒序分页，卡片点击放大查看，返回保持滚动；草稿随物体切换保留，更换照片重置。  
   - 验证：模拟 0/25 框分页与默认选中；连续点击描述生成被覆盖不叠加，故障显示模板与提示；保存时延迟下仍禁用，失败弹窗可重试，成功弹出双按钮；列表空态与分页正常，查看后返回定位正确；切换物体草稿保留，更换照片清空旧草稿。
9. **像素一致性与安全配置**：对比前端预览与后端合成的像素块（脚本计算平均色差或手工对比截图）；所有密钥仅来自环境变量，缺失时启动/调用给出清晰错误，不落盘。  
   - 验证：保存后下载作品与保存前截图比对像素块（允许轻微压缩差）；无密钥时启动失败且日志明确；确认供应商与 key 来源。
10. **端到端验收**：完整跑“主页→捕物上传→选物体→生成名称/描述→调时间/数值→拖拽标签→保存→珍藏查看”，对照验收清单勾选（唯一标签、三联动、金币固定、指针随时间变）。  
    - 验证：使用验收表逐项勾选，无缺项后标记通过。
